@model RazorKing.Models.ViewModels.HomeViewModel
@{
    ViewData["Title"] = "ریزر کینگ | آرایشگاه مردانه لوکس - رزرو آنلاین";
    Layout = "_LayoutModern";
}

<!-- Meta tag for base URL -->
<meta name="base-url" content="@Url.Content("~")" />

<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-background">
        <div class="hero-overlay"></div>
        <div class="hero-image">
            <img src="~/img/footer-bg.png" alt="Background" />
        </div>
    </div>
    <div class="hero-content">
        <div class="container">
            <div class="row align-items-center min-vh-100">
                <div class="col-lg-7">
                    <div class="hero-text animate-fade-in-up">
                        <span class="hero-badge animate-fade-in-up delay-200">
                            <i class="fas fa-map-marker-alt"></i>
                            استان گلستان
                        </span>
                        <h1 class="hero-title animate-fade-in-up delay-400">
                            آرایشگاه مردانه
                            <span class="text-gold gradient-text">ریزرکینگ</span>
                        </h1>
                        <p class="hero-subtitle animate-fade-in-up delay-600">
                            تجربه‌ای لوکس از آرایشگری مردانه با بهترین استایلیست‌های استان گلستان
                            <br>
                            <strong>رزرو آنلاین • بدون صف • خدمات VIP</strong>
                        </p>
                        <div class="hero-features animate-fade-in-up delay-800">
                            <div class="feature-badge">
                                <i class="fas fa-clock"></i>
                                <span>رزرو 24/7</span>
                            </div>
                            <div class="feature-badge">
                                <i class="fas fa-shield-check"></i>
                                <span>تضمین کیفیت</span>
                            </div>
                            <div class="feature-badge">
                                <i class="fas fa-star"></i>
                                <span>استایلیست حرفه‌ای</span>
                            </div>
                        </div>
                        <div class="hero-buttons animate-fade-in-up delay-1000">
                            <a href="@Url.Action("Index", "Booking")" class="btn btn-gold btn-lg btn-animated pulse-glow">
                                <i class="fas fa-calendar-plus"></i>
                                رزرو فوری نوبت
                            </a>
                            <a href="#services" class="btn btn-outline-light btn-lg btn-animated">
                                <i class="fas fa-cut"></i>
                                مشاهده خدمات
                            </a>
                        </div>
                        <div class="hero-secondary-buttons animate-fade-in-up delay-1200" style="margin-top: 15px;">
                            <button onclick="loadRealTimeStats()" class="btn btn-outline-gold btn-sm">
                                <i class="fas fa-sync-alt"></i>
                                به‌روزرسانی آمار
                            </button>
                            @if (User.Identity.IsAuthenticated)
                            {
                                <button onclick="checkUserAppointments()" class="btn btn-outline-light btn-sm" style="margin-right: 10px;">
                                    <i class="fas fa-calendar-check"></i>
                                    بررسی نوبت‌ها
                                </button>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="hero-stats animate-fade-in-right delay-1200" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
                        <div class="stats-container">
                            <div class="stat-item hover-lift">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-number" id="totalCustomers" data-count="@Model.TotalCustomers">@Model.TotalCustomers</div>
                                    <div class="stat-label">مشتری راضی</div>
                                </div>
                            </div>
                            <div class="stat-item hover-lift">
                                <div class="stat-icon">
                                    <i class="fas fa-store"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-number" id="totalBarbershops" data-count="@Model.TotalBarbershops">@Model.TotalBarbershops</div>
                                    <div class="stat-label">آرایشگاه فعال</div>
                                </div>
                            </div>
                            <div class="stat-item hover-lift">
                                <div class="stat-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-number" id="totalCities" data-count="@Model.Cities.Count">@Model.Cities.Count</div>
                                    <div class="stat-label">شهر فعال</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Compact User Profile Section -->
@if (User.Identity.IsAuthenticated && Model.UserProfile != null)
{
    <section class="user-profile-compact">
        <div class="container">
            <div class="profile-compact-card">
                <div class="profile-header">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <h4 class="user-name">سلام @Model.UserProfile.User.FirstName عزیز!</h4>
                        <div class="user-stats">
                            <span class="stat-item">
                                <i class="fas fa-calendar-check"></i>
                                @Model.UserProfile.TotalAppointments نوبت
                            </span>
                            <span class="stat-divider">•</span>
                            <span class="stat-item">
                                <i class="fas fa-clock"></i>
                                @Model.UserProfile.UpcomingAppointments.Count آینده
                            </span>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <a href="@Url.Action("Index", "Profile")" class="btn-profile">
                            <i class="fas fa-user-cog"></i>
                            پروفایل
                        </a>
                        <a href="@Url.Action("Index", "Booking")" class="btn-book">
                            <i class="fas fa-plus"></i>
                            رزرو جدید
                        </a>
                    </div>
                </div>
                
                @if (Model.UserProfile.UpcomingAppointments.Any())
                {
                    <div class="next-appointment">
                        @{
                            var nextAppointment = Model.UserProfile.UpcomingAppointments.First();
                        }
                        <div class="appointment-compact">
                            <div class="appointment-date-compact">
                                <span class="date">@nextAppointment.AppointmentDate.Day</span>
                                <span class="month">@nextAppointment.AppointmentDate.ToString("MMM")</span>
                            </div>
                            <div class="appointment-info-compact">
                                <h6>@nextAppointment.Barbershop.Name</h6>
                                <p>@nextAppointment.Service?.Name • @nextAppointment.AppointmentTime.ToString(@"hh\:mm")</p>
                            </div>
                            <div class="appointment-status-compact">
                                <span class="status-@nextAppointment.Status.ToString().ToLower()">
                                    @(nextAppointment.Status == AppointmentStatus.Confirmed ? "تایید شده" : "در انتظار")
                                </span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}

<!-- Quick Booking Bar -->
<section class="quick-booking-bar">
    <div class="quick-booking-background">
        <img src="~/img/hero-banner.jpg" alt="background" class="quick-booking-bg-image">
        <div class="quick-booking-overlay"></div>
    </div>
    <div class="container">
        <div class="quick-booking-content">
            <div class="quick-booking-text">
                <h3>نوبت فوری می‌خواهید؟</h3>
                <p>در کمتر از 2 دقیقه نوبت خود را رزرو کنید</p>
            </div>
            <div class="quick-booking-form">
                <select class="form-select" id="quickCitySelect">
                    <option value="">انتخاب شهر</option>
                    @foreach (var city in Model.Cities)
                    {
                        <option value="@city.Id">@city.Name</option>
                    }
                </select>
                <button class="btn btn-gold" onclick="quickBooking()">
                    <i class="fas fa-search"></i>
                    جستجو آرایشگاه
                </button>
            </div>
        </div>
    </div>
</section>

<!-- City Selection -->
<section class="city-section" id="cities">
    <div class="city-section-background">
        <img src="~/img/pricing-bg.jpg" alt="background" class="city-bg-image">
        <div class="city-section-overlay"></div>
    </div>
    <div class="container">
        <div class="section-header text-center">
            <span class="section-badge">انتخاب مکان</span>
            <h2 class="section-title">شهر خود را انتخاب کنید</h2>
            <p class="section-subtitle">در تمام شهرهای استان گلستان خدمات ما را دریافت کنید</p>
        </div>
        
        <!-- Cities Slider - 4 Per Row -->
        <div class="cities-slider-wrapper">
            <!-- Slider Controls -->
            <div class="slider-controls" style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
                <button class="btn btn-sm btn-outline-gold" onclick="window.enhancedCitiesSlider?.toggleAutoSlide()" title="توقف/شروع اسلایدر خودکار">
                    <i class="fas fa-play-pause"></i>
                    <span class="d-none d-md-inline">خودکار</span>
                </button>
                <button class="btn btn-sm btn-outline-gold" onclick="window.enhancedCitiesSlider?.goToRow(0)" title="رفتن به ابتدا">
                    <i class="fas fa-step-backward"></i>
                    <span class="d-none d-md-inline">ابتدا</span>
                </button>
                <button class="btn btn-sm btn-outline-gold" onclick="window.enhancedCitiesSlider?.goToRow(window.enhancedCitiesSlider?.totalRows - 1)" title="رفتن به انتها">
                    <i class="fas fa-step-forward"></i>
                    <span class="d-none d-md-inline">انتها</span>
                </button>
            </div>
            
            <div class="cities-slider-container" id="citiesSliderContainer">
                <div class="cities-slider-track" id="citiesSliderTrack">
                    @{
                        var citiesPerRow = 4;
                        var totalRows = (int)Math.Ceiling((double)Model.Cities.Count / citiesPerRow);
                    }
                    
                    @for (int row = 0; row < totalRows; row++)
                    {
                        var startIndex = row * citiesPerRow;
                        var endIndex = Math.Min(startIndex + citiesPerRow, Model.Cities.Count);
                        
                        @* Only create row if there are cities to show *@
                        @if (startIndex < Model.Cities.Count)
                        {
                            <div class="cities-row">
                                @for (int i = startIndex; i < endIndex; i++)
                                {
                                    var city = Model.Cities[i];
                                    <div class="city-slide-item">
                                        <div class="city-card" data-city-id="@city.Id" onclick="console.log('Clicked city: @city.Id'); window.location.href='@Url.Action("City", "Home", new { id = city.Id })'" style="cursor: pointer;">
                                            <div class="city-image">
                                                <img src="@ImageHelper.GetCityImage(i)" alt="@city.Name" onerror="this.src='~/img/background.webp'">
                                                <div class="city-overlay">
                                                    <i class="fas fa-map-marker-alt"></i>
                                                </div>
                                            </div>
                                            <div class="city-info">
                                                <h4>@city.Name</h4>
                                                <p>@city.Barbershops.Count(b => b.IsActive) آرایشگاه فعال</p>
                                                <div class="city-btn" onclick="event.stopPropagation();">
                                                    مشاهده آرایشگاه‌ها
                                                    <i class="fas fa-arrow-left"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                
                                @* Fill empty slots if needed to maintain grid structure *@
                                @for (int j = endIndex; j < startIndex + citiesPerRow; j++)
                                {
                                    <div class="city-slide-item city-empty-slot" style="visibility: hidden; pointer-events: none;">
                                        <div class="city-card" style="opacity: 0;"></div>
                                    </div>
                                }
                            </div>
                        }
                    }
                </div>
                
                <!-- Navigation Arrows -->
                <button class="cities-nav-btn cities-nav-prev" id="citiesPrevBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="cities-nav-btn cities-nav-next" id="citiesNextBtn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Dots Indicator -->
            <div class="cities-dots-container" id="citiesDotsContainer">
                @{
                    var actualRows = 0;
                    for (int row = 0; row < totalRows; row++)
                    {
                        var startIndex = row * citiesPerRow;
                        if (startIndex < Model.Cities.Count)
                        {
                            <div class="cities-dot @(actualRows == 0 ? "active" : "")" onclick="goToCityRow(@actualRows)"></div>
                            actualRows++;
                        }
                    }
                }
            </div>
        </div>
    </div>
</section>

<!-- Services Section -->
<section class="services-section bg-section" id="services">
    <div class="container">
        <div class="section-header text-center">
            <span class="section-badge">خدمات ما</span>
            <h2 class="section-title">خدمات حرفه‌ای آرایشگری</h2>
            <p class="section-subtitle">با بهترین تجهیزات و متخصص‌ترین آرایشگران</p>
        </div>
        
        <div class="services-grid">
            @if (Model.PopularServices != null && Model.PopularServices.Any())
            {
                @foreach (var service in Model.PopularServices)
                {
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-cut"></i>
                        </div>
                        <div class="service-content">
                            <h4>@service.Name</h4>
                            <p>خدمات حرفه‌ای @service.Name با بهترین کیفیت</p>
                            <ul class="service-features">
                                <li>کیفیت بالا</li>
                                <li>قیمت مناسب</li>
                                <li>خدمات سریع</li>
                            </ul>
                            <div class="service-price">
                                از @service.MinPrice.ToString("N0") تومان
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <!-- Default Services -->
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-cut"></i>
                    </div>
                    <div class="service-content">
                        <h4>کوتاهی مو</h4>
                        <p>انواع مدل‌های مدرن و کلاسیک کوتاهی مو با بهترین تکنیک‌ها</p>
                        <ul class="service-features">
                            <li>فید و لاین</li>
                            <li>مدل‌های مدرن</li>
                            <li>کوتاهی کلاسیک</li>
                        </ul>
                        <div class="service-price">
                            از 50,000 تومان
                        </div>
                    </div>
                </div>
                
                <div class="service-card featured">
                    <div class="service-badge">محبوب</div>
                    <div class="service-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="service-content">
                        <h4>اصلاح صورت</h4>
                        <p>اصلاح حرفه‌ای ریش و سبیل با تیغ‌های تیز و محصولات لوکس</p>
                        <ul class="service-features">
                            <li>اصلاح با تیغ</li>
                            <li>طراحی ریش</li>
                            <li>ماساژ صورت</li>
                        </ul>
                        <div class="service-price">
                            از 40,000 تومان
                        </div>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div class="service-content">
                        <h4>رنگ و مش</h4>
                        <p>رنگ‌آمیزی و مش مو با بهترین محصولات و رنگ‌های مد روز</p>
                        <ul class="service-features">
                            <li>هایلایت</li>
                            <li>آمبره</li>
                            <li>بالیاژ</li>
                        </ul>
                        <div class="service-price">
                            از 80,000 تومان
                        </div>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-icon">
                        <i class="fas fa-spa"></i>
                    </div>
                    <div class="service-content">
                        <h4>ماساژ و اسپا</h4>
                        <p>ماساژ آرام‌بخش صورت و سر برای رفع خستگی و استرس</p>
                        <ul class="service-features">
                            <li>ماساژ صورت</li>
                            <li>ماساژ سر</li>
                            <li>ماسک صورت</li>
                        </ul>
                        <div class="service-price">
                            از 60,000 تومان
                        </div>
                    </div>
                </div>
            }
        </div>
        
        <div class="text-center mt-5">
            <a href="@Url.Action("Index", "Booking")" class="btn btn-gold btn-lg">
                <i class="fas fa-calendar-plus"></i>
                رزرو نوبت
            </a>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="features-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="features-content">
                    <span class="section-badge">چرا ریزر کینگ؟</span>
                    <h2 class="section-title">تجربه‌ای متفاوت از آرایشگری</h2>
                    <p class="section-subtitle">
                        با سیستم رزرو آنلاین ما، دیگر نیازی به انتظار در صف نیست
                    </p>
                    
                    <div class="features-list">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="feature-text">
                                <h5>رزرو 24 ساعته</h5>
                                <p>در هر ساعت از شبانه‌روز نوبت خود را رزرو کنید</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="feature-text">
                                <h5>آرایشگران حرفه‌ای</h5>
                                <p>بهترین و باتجربه‌ترین آرایشگران استان</p>
                            </div>
                        </div>
                        
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="feature-text">
                                <h5>تضمین کیفیت</h5>
                                <p>رضایت 100% مشتریان یا بازگشت وجه</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="features-image">
                    <img src="~/img/sign-up-background.png" alt="فضای آرایشگاه" class="img-fluid">
                    <div class="image-overlay">
                        <div class="play-button">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- City Barbershops Modal -->
<div class="modal fade" id="cityModal" tabindex="-1" aria-labelledby="cityModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content city-modal-content">
            <div class="modal-header city-modal-header">
                <h5 class="modal-title" id="cityModalLabel">
                    <i class="fas fa-map-marker-alt text-gold"></i>
                    <span id="cityModalTitle">آرایشگاه‌های شهر</span>
                </h5>
                <button type="button" class="btn-close city-modal-close" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body city-modal-body">
                <div id="cityBarbershopsLoading" class="text-center py-5">
                    <div class="spinner-border text-gold" role="status">
                        <span class="visually-hidden">در حال بارگذاری...</span>
                    </div>
                    <p class="mt-3 text-muted">در حال بارگذاری آرایشگاه‌ها...</p>
                </div>
                <div id="cityBarbershopsContent" class="d-none">
                    <div class="row" id="barbershopsGrid">
                        <!-- Barbershops will be loaded here -->
                    </div>
                </div>
                <div id="cityBarbershopsEmpty" class="text-center py-5 d-none">
                    <i class="fas fa-store-slash fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">آرایشگاهی یافت نشد</h5>
                    <p class="text-muted">در حال حاضر آرایشگاه فعالی در این شهر وجود ندارد.</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/home-profile.css" asp-append-version="true">
}

@section Scripts {
    <script src="~/js/home.js" asp-append-version="true"></script>
    <script src="~/js/cities-slider-enhanced.js" asp-append-version="true"></script>
    <script>
        // Debug script to ensure stats are visible
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Debug: Page loaded');
            const statsContainer = document.querySelector('.hero-stats');
            if (statsContainer) {
                console.log('Debug: Stats container found');
                statsContainer.style.display = 'block';
                statsContainer.style.visibility = 'visible';
                statsContainer.style.opacity = '1';
                
                const statItems = document.querySelectorAll('.stat-item');
                console.log('Debug: Found', statItems.length, 'stat items');
                
                statItems.forEach((item, index) => {
                    item.style.display = 'block';
                    item.style.visibility = 'visible';
                    item.style.opacity = '1';
                    console.log('Debug: Stat item', index, 'made visible');
                });
            } else {
                console.log('Debug: Stats container NOT found');
            }
        });
    </script>
}

