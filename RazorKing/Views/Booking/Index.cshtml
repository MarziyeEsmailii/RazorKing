@model RazorKing.Models.ViewModels.BookingViewModel
@{
    ViewData["Title"] = "رزرو نوبت آرایشگاه مردانه - استان گلستان";
    Layout = "_LayoutModern";
}

<section class="booking-section">
    <div class="container">
        <!-- Header -->
        <div class="booking-header text-center mb-5">
            <span class="section-badge">رزرو آنلاین</span>
            <h1 class="section-title">رزرو نوبت آرایشگاه مردانه</h1>
            <p class="section-subtitle">در استان گلستان، بهترین آرایشگاه را انتخاب کنید</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="booking-wizard">
                    <!-- Progress Steps -->
                    <div class="wizard-steps">
                        <div class="step active" data-step="1">
                            <div class="step-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <span>انتخاب شهر</span>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <span>انتخاب آرایشگاه</span>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-icon">
                                <i class="fas fa-cut"></i>
                            </div>
                            <span>انتخاب خدمات</span>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <span>انتخاب زمان</span>
                        </div>
                        <div class="step" data-step="5">
                            <div class="step-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <span>انتخاب ساعت</span>
                        </div>
                        <div class="step" data-step="6">
                            <div class="step-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <span>اطلاعات شخصی</span>
                        </div>
                        <div class="step" data-step="7">
                            <div class="step-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <span>پرداخت</span>
                        </div>
                    </div>

                    <!-- Booking Form -->
                    <div class="booking-form-container">
                        <form id="bookingForm" class="booking-form">
                            <!-- Step 1: انتخاب شهر -->
                            <div class="form-step active" id="step1">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-map-marker-alt"></i>
                                        انتخاب شهر
                                    </h3>
                                    <p class="step-description">شهر خود را از شهرهای استان گلستان انتخاب کنید</p>
                                    
                                    <div class="cities-grid">
                                        @foreach (var city in Model.Cities)
                                        {
                                            <div class="city-option" data-city-id="@city.Id">
                                                <div class="city-icon">
                                                    <i class="fas fa-building"></i>
                                                </div>
                                                <h5>@city.Name</h5>
                                                <p>استان @city.Province</p>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: انتخاب آرایشگاه -->
                            <div class="form-step" id="step2">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-store"></i>
                                        انتخاب آرایشگاه
                                    </h3>
                                    <p class="step-description">آرایشگاه مورد نظر خود را انتخاب کنید</p>
                                    
                                    <div id="barbershopsList" class="barbershops-grid">
                                        <!-- Barbershops will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: انتخاب خدمات -->
                            <div class="form-step" id="step3">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-cut"></i>
                                        انتخاب خدمات
                                    </h3>
                                    <p class="step-description">خدمات مورد نیاز خود را انتخاب کنید</p>
                                    
                                    <div id="servicesList" class="services-grid">
                                        <!-- Services will be loaded here -->
                                    </div>
                                    
                                    <div class="price-summary">
                                        <div class="price-item">
                                            <span>مجموع هزینه:</span>
                                            <span id="totalPrice" class="price-value">0 تومان</span>
                                        </div>
                                        <div class="price-item deposit">
                                            <span>بیعانه (30%):</span>
                                            <span id="depositAmount" class="price-value">0 تومان</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: انتخاب روز -->
                            <div class="form-step" id="step4">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-calendar"></i>
                                        انتخاب روز
                                    </h3>
                                    <p class="step-description">روز مناسب خود را از روزهای خالی انتخاب کنید</p>
                                    
                                    <div id="datesList" class="dates-grid">
                                        <!-- Available dates will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 5: انتخاب ساعت -->
                            <div class="form-step" id="step5">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-clock"></i>
                                        انتخاب ساعت
                                    </h3>
                                    <p class="step-description">ساعت مناسب خود را از ساعات خالی انتخاب کنید</p>
                                    
                                    <div id="timesList" class="times-container">
                                        <!-- Available times will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 6: اطلاعات شخصی -->
                            <div class="form-step" id="step6">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-user"></i>
                                        اطلاعات شخصی
                                    </h3>
                                    <p class="step-description">اطلاعات تماس خود را وارد کنید</p>
                                    
                                    <div class="customer-info">
                                        <form id="customerForm">
                                            <div class="form-group">
                                                <label for="customerName" class="form-label">
                                                    <i class="fas fa-user"></i>
                                                    نام و نام خانوادگی
                                                </label>
                                                <input type="text" class="form-control" name="customerName" id="customerName" 
                                                       placeholder="نام کامل خود را وارد کنید" required>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="customerPhone" class="form-label">
                                                    <i class="fas fa-phone"></i>
                                                    شماره تماس
                                                </label>
                                                <input type="tel" class="form-control" name="customerPhone" id="customerPhone" 
                                                       placeholder="09xxxxxxxxx" required>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="customerNotes" class="form-label">
                                                    <i class="fas fa-comment"></i>
                                                    توضیحات (اختیاری)
                                                </label>
                                                <textarea class="form-control" name="notes" id="customerNotes" rows="3"
                                                          placeholder="توضیحات اضافی در مورد نوبت خود..."></textarea>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 7: پرداخت و تایید نهایی -->
                            <div class="form-step" id="step7">
                                <div class="step-content">
                                    <h3 class="step-title">
                                        <i class="fas fa-credit-card"></i>
                                        پرداخت و تایید نهایی
                                    </h3>
                                    <p class="step-description">خلاصه نوبت و پرداخت بیعانه</p>
                                    
                                    <div class="final-summary">
                                        <div class="booking-summary">
                                            <h4>خلاصه نهایی رزرو</h4>
                                            <div class="summary-item">
                                                <span>شهر:</span>
                                                <span id="finalSummaryCity">-</span>
                                            </div>
                                            <div class="summary-item">
                                                <span>آرایشگاه:</span>
                                                <span id="finalSummaryBarbershop">-</span>
                                            </div>
                                            <div class="summary-item">
                                                <span>خدمات:</span>
                                                <span id="finalSummaryServices">-</span>
                                            </div>
                                            <div class="summary-item">
                                                <span>تاریخ:</span>
                                                <span id="finalSummaryDate">-</span>
                                            </div>
                                            <div class="summary-item">
                                                <span>ساعت:</span>
                                                <span id="finalSummaryTime">-</span>
                                            </div>
                                            <div class="summary-item">
                                                <span>نام مشتری:</span>
                                                <span id="finalSummaryCustomer">-</span>
                                            </div>
                                            <div class="summary-item total">
                                                <span>مجموع هزینه:</span>
                                                <span id="finalSummaryTotal">0 تومان</span>
                                            </div>
                                            <div class="summary-item deposit">
                                                <span>بیعانه قابل پرداخت:</span>
                                                <span id="finalSummaryDeposit">0 تومان</span>
                                            </div>
                                        </div>
                                        
                                        <div class="payment-section">
                                            <form id="paymentForm">
                                                <div class="payment-notice">
                                                    <div class="notice-icon">
                                                        <i class="fas fa-info-circle"></i>
                                                    </div>
                                                    <div class="notice-content">
                                                        <h5>نکات مهم:</h5>
                                                        <ul>
                                                            <li>30% از مبلغ کل به عنوان بیعانه پرداخت می‌شود</li>
                                                            <li>مابقی مبلغ در آرایشگاه پرداخت خواهد شد</li>
                                                            <li>15 دقیقه قبل از ساعت نوبت حضور یابید</li>
                                                            <li>در صورت کنسلی 24 ساعت قبل اطلاع دهید</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                
                                                <div class="payment-confirmation">
                                                    <label class="checkbox-container">
                                                        <input type="checkbox" id="termsAccept" required>
                                                        <span class="checkmark"></span>
                                                        قوانین و شرایط را مطالعه کرده و می‌پذیرم
                                                    </label>
                                                </div>
                                            </form>
                                        </div>
                                        
                                        <div id="bookingResult" class="booking-result">
                                            <!-- Booking result will be shown here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Navigation Buttons -->
                            <div class="form-navigation">
                                <button type="button" id="prevBtn" class="btn btn-outline-gold navigation-btn" style="display: none;">
                                    <i class="fas fa-arrow-right"></i>
                                    مرحله قبل
                                </button>
                                <button type="button" id="nextBtn" class="btn btn-gold navigation-btn" style="display: none;">
                                    مرحله بعد
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <button type="button" id="finalSubmitBtn" class="btn btn-gold btn-lg navigation-btn" style="display: none;">
                                    <i class="fas fa-check-circle"></i>
                                    تایید نهایی و ثبت نوبت
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Booking Styles -->
<style>
.booking-section {
    background: var(--gradient-primary);
    min-height: 100vh;
    padding: 120px 0 60px;
}

.booking-header {
    margin-bottom: 60px;
}

.booking-wizard {
    background: var(--bg-card);
    border-radius: 20px;
    padding: 40px;
    box-shadow: var(--shadow-heavy);
    border: 1px solid rgba(212, 175, 55, 0.1);
}

.wizard-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 50px;
    position: relative;
}

.wizard-steps::before {
    content: '';
    position: absolute;
    top: 25px;
    left: 50px;
    right: 50px;
    height: 2px;
    background: rgba(212, 175, 55, 0.2);
    z-index: 1;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
    z-index: 2;
    flex: 1;
}

.step-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--medium-gray);
    border: 2px solid rgba(212, 175, 55, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
    transition: all var(--transition-normal);
}

.step.active .step-icon,
.step.completed .step-icon {
    background: var(--primary-gold);
    border-color: var(--primary-gold);
    color: var(--primary-black);
}

.step span {
    font-size: var(--font-size-sm);
    color: var(--text-gray);
    font-weight: 500;
}

.step.active span,
.step.completed span {
    color: var(--primary-gold);
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
    animation: fadeInUp 0.5s ease-out;
}

.step-title {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--text-white);
    margin-bottom: 10px;
}

.step-title i {
    color: var(--primary-gold);
}

.step-description {
    color: var(--text-gray);
    margin-bottom: 40px;
    font-size: var(--font-size-base);
}

.cities-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.city-option {
    background: var(--medium-gray);
    border: 2px solid rgba(212, 175, 55, 0.2);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-normal);
}

.city-option:hover,
.city-option.selected {
    border-color: var(--primary-gold);
    background: rgba(212, 175, 55, 0.1);
    transform: translateY(-5px);
}

.city-icon {
    width: 60px;
    height: 60px;
    background: rgba(212, 175, 55, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
}

.city-icon i {
    font-size: var(--font-size-xl);
    color: var(--primary-gold);
}

.city-option h5 {
    color: var(--text-white);
    margin-bottom: 5px;
    font-weight: 600;
}

.city-option p {
    color: var(--text-gray);
    font-size: var(--font-size-sm);
    margin: 0;
}

.barbershops-grid,
.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.barbershop-card,
.service-card {
    background: var(--medium-gray);
    border: 2px solid rgba(212, 175, 55, 0.2);
    border-radius: 15px;
    padding: 25px;
    cursor: pointer;
    transition: all var(--transition-normal);
}

.barbershop-card:hover,
.barbershop-card.selected,
.service-card:hover,
.service-card.selected {
    border-color: var(--primary-gold);
    background: rgba(212, 175, 55, 0.1);
    transform: translateY(-3px);
}

.price-summary {
    background: var(--dark-gray);
    border-radius: 15px;
    padding: 25px;
    margin-top: 30px;
}

.price-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-size: var(--font-size-base);
}

.price-item:last-child {
    margin-bottom: 0;
}

.price-item.deposit {
    border-top: 1px solid rgba(212, 175, 55, 0.3);
    padding-top: 15px;
    font-weight: 600;
}

.price-value {
    color: var(--primary-gold);
    font-weight: 700;
}

.form-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid rgba(212, 175, 55, 0.2);
}

.navigation-btn {
    padding: 12px 30px;
    border-radius: 25px;
    font-weight: 600;
    transition: all var(--transition-normal);
}

.btn-gold {
    background: var(--primary-gold);
    border: 2px solid var(--primary-gold);
    color: var(--primary-black);
}

.btn-gold:hover {
    background: transparent;
    color: var(--primary-gold);
}

.btn-outline-gold {
    background: transparent;
    border: 2px solid var(--primary-gold);
    color: var(--primary-gold);
}

.btn-outline-gold:hover {
    background: var(--primary-gold);
    color: var(--primary-black);
}

media (max-width: 768px) {
    .wizard-steps {
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .step {
        flex: 1 1 calc(50% - 10px);
        min-width: 120px;
    }
    
    .cities-grid,
    .barbershops-grid,
    .services-grid {
        grid-template-columns: 1fr;
    }
}
</style>

@section Scripts {
    <script src="~/js/booking.js"></script>
}