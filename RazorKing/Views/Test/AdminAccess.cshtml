@{
    ViewData["Title"] = "ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Admin";
    Layout = "_LayoutModern";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ”§ ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Admin</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5>ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ:</h5>
                        <p><strong>Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª:</strong> @(ViewBag.IsAuthenticated ? "âœ… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡" : "âŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡")</p>
                        <p><strong>Ø¯Ø³ØªØ±Ø³ÛŒ Admin:</strong> @(ViewBag.IsAdmin ? "âœ… Ø¯Ø§Ø±Ø¯" : "âŒ Ù†Ø¯Ø§Ø±Ø¯")</p>
                        <p><strong>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:</strong> @ViewBag.UserInfo</p>
                    </div>

                    @if (ViewBag.Error != null)
                    {
                        <div class="alert alert-danger">
                            <strong>Ø®Ø·Ø§:</strong> @ViewBag.Error
                        </div>
                    }

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>ğŸ”‘ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Admin</h5>
                                </div>
                                <div class="card-body">
                                    <button class="btn btn-primary mb-2" onclick="createAdminUser()">
                                        Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Admin
                                    </button>
                                    <br>
                                    <a href="/Account/Login" class="btn btn-success mb-2">
                                        ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…
                                    </a>
                                    <br>
                                    <a href="/admin" class="btn btn-warning mb-2">
                                        Ù¾Ù†Ù„ Admin
                                    </a>
                                    <br>
                                    <button class="btn btn-info mb-2" onclick="checkAppointments()">
                                        Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§
                                    </button>
                                    <br>
                                    <button class="btn btn-secondary mb-2" onclick="checkUserAppointments()">
                                        Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
                                    </button>
                                    <br>
                                    <button class="btn btn-success mb-2" onclick="createTestAppointment()">
                                        Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¨Øª ØªØ³Øª
                                    </button>
                                    <br>
                                    <button class="btn btn-warning mb-2" onclick="createSimpleTestAppointment()">
                                        Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¨Øª Ø³Ø§Ø¯Ù‡
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Admin Ù…ÙˆØ¬ÙˆØ¯</h5>
                                </div>
                                <div class="card-body">
                                    @if (ViewBag.AdminUsers != null)
                                    {
                                        @foreach (var user in (List<ApplicationUser>)ViewBag.AdminUsers)
                                        {
                                            <div class="alert alert-secondary">
                                                <strong>@user.Email</strong><br>
                                                Ù†Ø§Ù…: @user.FirstName @user.LastName<br>
                                                ÙØ¹Ø§Ù„: @(user.IsActive ? "âœ…" : "âŒ")
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>ğŸ“‹ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÙˆØ±ÙˆØ¯ Admin:</h5>
                        <div class="alert alert-warning">
                            <p><strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> admin@razorking.com</p>
                            <p><strong>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</strong> Admin123!</p>
                            <p><strong>Ù…Ø³ÛŒØ± ÙˆØ±ÙˆØ¯:</strong> <a href="/Account/Login">/Account/Login</a></p>
                            <p><strong>Ù¾Ù†Ù„ Admin:</strong> <a href="/admin">/admin</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function createAdminUser() {
    try {
        const response = await fetch('/Test/CreateAdminUser', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('âœ… ' + result.message);
            location.reload();
        } else {
            alert('âŒ ' + result.message);
        }
    } catch (error) {
        alert('Ø®Ø·Ø§: ' + error.message);
    }
}

async function checkAppointments() {
    try {
        const response = await fetch('/Test/CheckAppointments');
        const result = await response.json();
        
        if (result.success) {
            console.log('ğŸ“Š Ú©Ù„ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§:', result);
            alert(`ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§: ${result.count}\n\nØ¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Console Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª.`);
        } else {
            alert('âŒ Ø®Ø·Ø§: ' + result.error);
        }
    } catch (error) {
        alert('Ø®Ø·Ø§: ' + error.message);
    }
}

async function checkUserAppointments() {
    try {
        const response = await fetch('/Test/CheckUserAppointments');
        const result = await response.json();
        
        if (result.success) {
            console.log('ğŸ“Š Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±:', result);
            
            let message = `ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±:
            
ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:
- Ø§ÛŒÙ…ÛŒÙ„: ${result.userInfo.email}
- Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${result.userInfo.userName}
- Ù†Ø§Ù…: ${result.userInfo.firstName} ${result.userInfo.lastName}

ğŸ“ˆ Ø¢Ù…Ø§Ø± Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§:
- Ú©Ù„ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ…: ${result.totalAppointments}
- Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ…ÛŒÙ„): ${result.userAppointmentsByEmail}
- Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø± Ø§Ø³Ø§Ø³ ID): ${result.userAppointmentsById}
- Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ): ${result.userAppointmentsByUserName}

Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø¯Ø± Console Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª.`;
            
            alert(message);
        } else {
            alert('âŒ Ø®Ø·Ø§: ' + result.error);
        }
    } catch (error) {
        alert('Ø®Ø·Ø§: ' + error.message);
    }
}

async function createTestAppointment() {
    try {
        const response = await fetch('/Test/CreateTestAppointment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('âœ… Ù†ÙˆØ¨Øª ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯:', result);
            
            alert(`âœ… Ù†ÙˆØ¨Øª ØªØ³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!
            
ğŸ“… Ø¬Ø²Ø¦ÛŒØ§Øª:
- Ø´Ù†Ø§Ø³Ù‡: ${result.appointment.id}
- ØªØ§Ø±ÛŒØ®: ${result.appointment.date}
- Ø³Ø§Ø¹Øª: ${result.appointment.time}
- Ø¢Ø±Ø§ÛŒØ´Ú¯Ø§Ù‡: ${result.appointment.barbershop}
- Ø®Ø¯Ù…Øª: ${result.appointment.service}
- Ù‚ÛŒÙ…Øª: ${result.appointment.price} ØªÙˆÙ…Ø§Ù†

Ø­Ø§Ù„Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ "Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§" Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.`);
        } else {
            console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¨Øª ØªØ³Øª:', result);
            alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¨Øª ØªØ³Øª: ' + result.error);
        }
    } catch (error) {
        alert('Ø®Ø·Ø§: ' + error.message);
    }
}

async function createSimpleTestAppointment() {
    try {
        const response = await fetch('/Test/CreateSimpleTestAppointment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('âœ… Ù†ÙˆØ¨Øª Ø³Ø§Ø¯Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯:', result);
            alert(`âœ… Ù†ÙˆØ¨Øª Ø³Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯! Ø´Ù†Ø§Ø³Ù‡: ${result.appointmentId}\n\nØ­Ø§Ù„Ø§ "Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§" Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.`);
        } else {
            console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¨Øª Ø³Ø§Ø¯Ù‡:', result);
            alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ¨Øª Ø³Ø§Ø¯Ù‡:\n${result.error}\n${result.innerError || ''}`);
        }
    } catch (error) {
        alert('Ø®Ø·Ø§: ' + error.message);
    }
}
</script>